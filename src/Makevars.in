CXX_STD = CXX20

PKG_CPPFLAGS = -I./core/src \
               -I../inst/include \
               @INCLUDE_FLAGS@ \
               -O3 -DNDEBUG -march=native -mtune=native -funroll-loops \
               -fno-math-errno \
               -funsafe-math-optimizations \
               -fno-trapping-math \
               -fno-signed-zeros \
               -fcx-limited-range \
               -fexcess-precision=fast \
               -flto -fstrict-aliasing

SOURCES = main.cpp RcppExports.cpp $(wildcard core/src/*.cpp)
OBJECTS = $(SOURCES:.cpp=.o)

PKG_LIBS = @LIB_FLAGS@ \
           $(shell "${R_HOME}/bin/R" CMD config BLAS_LIBS) \
           $(shell "${R_HOME}/bin/R" CMD config LAPACK_LIBS) \
           $(shell "${R_HOME}/bin/R" CMD config FLIBS)

wendy.so: $(OBJECTS)
	$(CXX) $(PKG_CPPFLAGS) -std=gnu++20 -shared -o wendy.so $(OBJECTS) $(PKG_LIBS)